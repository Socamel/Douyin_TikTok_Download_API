# 🗄️ SQLite数据库管理界面使用说明

## 📊 端口配置表

| 服务 | 端口 | 用途 |
|------|------|------|
| **FastAPI** | **8501** | 主API服务 |
| **Streamlit** | **8502** | 数据库管理界面 |
| **Streamlit** | **8503** | 备用端口 |
| **Streamlit** | **8504** | 故障排除端口 |
| **Streamlit** | **8505** | HTTPS生产环境 |

## 📋 概述

这是一个基于Streamlit开发的SQLite数据库管理界面，提供了友好的Web界面来管理您的抖音/TikTok数据。界面美观、功能完整、操作简单。

## 🚀 快速开始

### 1. 安装依赖

```bash
# 安装所有依赖（已包含Streamlit）
pip install -r requirements.txt
```

### 2. 启动应用

#### 方法一：直接运行Streamlit（推荐）
```bash
streamlit run start_database_ui.py --server.port 8502
```

#### 方法二：使用虚拟环境
```bash
# 激活虚拟环境
& d:/GitHub/Douyin_TikTok_Download_API/venv/Scripts/Activate.ps1

# 启动界面
streamlit run start_database_ui.py --server.port 8502
```

#### 方法三：后台运行（Linux/Mac）
```bash
nohup streamlit run start_database_ui.py --server.port 8502 &
```

### 3. 访问界面

- **本地访问**：http://localhost:8502
- **网络访问**：http://192.168.31.195:8502

## 📊 功能模块详解

### 1. 数据概览 📊

**功能特点：**
- 实时显示数据库统计信息
- 美观的指标卡片展示
- 最近数据快速预览

**包含内容：**
- **用户总数**：数据库中注册的用户数量
- **视频总数**：所有视频的数量
- **活跃Cookie**：当前可用的Cookie数量
- **总Cookie数**：所有Cookie的总数
- **最近用户**：最近添加的10个用户列表

### 2. 用户管理 👥

**添加用户功能：**
- 用户ID（必填）：抖音用户的sec_user_id
- 昵称：用户显示名称
- 粉丝数：用户粉丝数量
- 视频数：用户发布的视频数量

**用户列表功能：**
- 显示所有用户信息
- 支持删除操作
- 实时数据更新

**删除用户功能：**
- 选择要删除的用户
- 确认删除操作
- 删除后自动刷新列表

### 3. Cookie管理 🍪

**添加Cookie功能：**
- Cookie数据（必填）：完整的Cookie字符串
- 平台选择：抖音/TikTok/B站
- 自动设为活跃状态

**Cookie列表功能：**
- 显示所有Cookie记录
- 平台分类显示
- 活跃状态显示

### 4. 视频管理 🎥

**视频列表功能：**
- 显示所有视频信息
- 关联用户和博主信息
- 按时间排序显示

**批量操作功能：**
- 清空所有视频
- 安全确认机制
- 操作后自动刷新

### 5. 数据库维护 🔧

**数据库统计：**
- 实时显示各表数据量
- 数据库健康状态监控

**数据清理功能：**
- 清空所有用户
- 清空所有Cookie
- 清空所有视频
- 安全确认机制

**数据库备份：**
- 导出数据库文件
- 自动时间戳命名
- 本地备份存储

## 🔧 配置选项

### 端口配置
默认端口：8502
如需修改端口，可以：
```bash
streamlit run start_database_ui.py --server.port 8503
```

### 网络访问配置
默认只允许本地访问，如需远程访问：
```bash
streamlit run start_database_ui.py --server.address 0.0.0.0
```

### 完整启动命令
```bash
streamlit run start_database_ui.py --server.port 8502 --server.address 0.0.0.0
```

## 🛠️ 技术特性

### 界面特性
- **响应式设计**：适配不同屏幕尺寸
- **直观操作**：无需SQL知识，图形化操作
- **实时反馈**：操作结果立即显示
- **错误处理**：友好的错误提示信息

### 安全特性
- **操作确认**：重要操作需要用户确认
- **数据验证**：输入数据自动验证
- **异常处理**：完善的错误处理机制

### 数据特性
- **SQLite数据库**：轻量级、无需额外配置
- **自动备份**：支持数据库文件导出
- **数据完整性**：外键约束保证数据一致性

## 📁 文件结构

```
Douyin_TikTok_Download_API/
├── start_database_ui.py          # Streamlit主应用文件
├── database.py                   # 数据库管理核心
├── douyin_data.db               # SQLite数据库文件
├── requirements.txt             # 项目依赖（已包含Streamlit）
└── 数据库管理界面使用说明.md      # 本说明文档
```

## 🔧 数据库表结构

### users表
- `user_id`: 用户唯一标识
- `username`: 用户名
- `nickname`: 昵称
- `avatar_url`: 头像URL
- `follower_count`: 粉丝数
- `following_count`: 关注数
- `video_count`: 视频数
- `created_at`: 创建时间
- `updated_at`: 更新时间

### videos表
- `video_id`: 视频唯一标识
- `user_id`: 所属用户ID
- `title`: 视频标题
- `video_url`: 视频URL
- `cover_url`: 封面URL
- `duration`: 视频时长
- `play_count`: 播放数
- `like_count`: 点赞数
- `comment_count`: 评论数
- `share_count`: 分享数
- `created_at`: 创建时间
- `douyin_created_at`: 抖音创建时间

### cookies表
- `id`: 主键ID
- `cookie_data`: Cookie内容
- `platform`: 平台名称
- `is_active`: 是否活跃
- `created_at`: 创建时间
- `updated_at`: 更新时间
- `expires_at`: 过期时间

## 🚨 注意事项

### 数据安全
- **定期备份**：建议定期导出数据库文件
- **谨慎删除**：删除操作不可恢复
- **权限控制**：确保只有授权用户访问

### 性能优化
- **数据量控制**：避免存储过多历史数据
- **定期清理**：定期清理过期数据
- **索引优化**：数据库已建立必要索引

### 故障排除
- **端口冲突**：如果8502端口被占用，可更换其他端口
- **依赖问题**：确保已安装所有依赖包
- **权限问题**：确保对数据库文件有读写权限

## 📞 技术支持

如遇到问题，请检查：
1. Python环境是否正确
2. 依赖包是否完整安装
3. 数据库文件是否存在
4. 端口是否被占用

## 🔄 更新日志

### v1.1.0 (2025-09-01)
- ✅ 新增视频管理模块
- ✅ 新增数据库维护模块
- ✅ 支持批量数据清理
- ✅ 支持数据库备份功能
- ✅ 优化用户界面体验

### v1.0.0 (2025-09-01)
- ✅ 初始版本发布
- ✅ 支持用户、Cookie管理
- ✅ 支持数据库统计
- ✅ 完整的Web界面操作

### 完整启动命令示例
```bash
streamlit run streamlit_database_ui.py \
  --server.port 8502 \
  --server.address 0.0.0.0 \
  --server.headless true \
  --browser.gatherUsageStats false
```

## 📁 文件结构

```
├── streamlit_database_ui.py    # 主应用文件
├── start_database_ui.py        # 启动脚本
├── requirements_streamlit.txt  # 依赖文件
├── database.py                 # 数据库管理器
├── douyin_data.db             # SQLite数据库文件
└── 数据库管理界面使用说明.md    # 本说明文档
```

## 🐳 Docker部署

### 创建Dockerfile
```dockerfile
FROM python:3.9-slim

WORKDIR /app

# 安装系统依赖
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# 复制依赖文件并安装
COPY requirements_streamlit.txt .
RUN pip install -r requirements_streamlit.txt

# 复制应用文件
COPY . .

# 暴露端口
EXPOSE 8501

# 启动命令
CMD ["streamlit", "run", "streamlit_database_ui.py", "--server.port=8502", "--server.address=0.0.0.0"]
```

### 构建和运行
```bash
# 构建镜像
docker build -t database-ui .

# 运行容器
docker run -d -p 8502:8502 --name database-ui database-ui

# 查看日志
docker logs database-ui

# 停止容器
docker stop database-ui
```

### Docker Compose部署
创建 `docker-compose.yml`：
```yaml
version: '3.8'
services:
  database-ui:
    build: .
    ports:
      - "8502:8502"
    volumes:
      - ./douyin_data.db:/app/douyin_data.db
    restart: unless-stopped
```

运行：
```bash
docker-compose up -d
```

## 🔒 安全注意事项

### 生产环境部署建议
1. **使用HTTPS**：
   ```bash
   streamlit run streamlit_database_ui.py --server.port 8505 --server.sslCertFile cert.pem --server.sslKeyFile key.pem
   ```

2. **配置身份验证**：
   - 使用Nginx反向代理
   - 配置Basic Auth
   - 使用OAuth2认证

3. **限制网络访问**：
   - 只允许特定IP访问
   - 使用防火墙规则
   - 配置VPN访问

### 数据安全
1. **定期备份**：
   ```bash
   # 备份数据库
   cp douyin_data.db backup/douyin_data_$(date +%Y%m%d).db
   ```

2. **版本控制**：
   - 将配置文件加入Git
   - 定期提交数据库结构变更

3. **权限管理**：
   - 限制数据库文件权限
   - 使用专用用户运行服务

## 🛠️ 故障排除

### 常见问题及解决方案

#### 1. 端口被占用
```bash
# 查看端口占用
netstat -an | findstr :8502  # Windows
netstat -an | grep :8502     # Linux/Mac

# 使用其他端口
streamlit run streamlit_database_ui.py --server.port 8503
```

#### 2. 依赖安装失败
```bash
# 升级pip
python -m pip install --upgrade pip

# 重新安装依赖
pip install --force-reinstall streamlit pandas

# 使用虚拟环境
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
pip install -r requirements_streamlit.txt
```

#### 3. 数据库连接错误
```bash
# 检查数据库文件
ls -la douyin_data.db

# 检查文件权限
chmod 644 douyin_data.db

# 验证数据库完整性
sqlite3 douyin_data.db "PRAGMA integrity_check;"
```

#### 4. 界面无法访问
```bash
# 检查服务状态
ps aux | grep streamlit

# 检查防火墙
sudo ufw status

# 重启服务
pkill -f streamlit
streamlit run streamlit_database_ui.py --server.port 8504
```

### 日志查看
Streamlit会自动生成日志，可以在控制台查看错误信息：
```bash
# 查看实时日志
tail -f ~/.streamlit/logs/streamlit.log
```

## 📈 扩展功能

### 计划中的功能
- [ ] **数据导出功能**：支持CSV、Excel格式导出
- [ ] **数据可视化图表**：用户增长趋势、视频统计图表
- [ ] **批量操作功能**：批量导入用户、批量删除
- [ ] **数据备份/恢复**：自动备份、一键恢复
- [ ] **用户权限管理**：多用户登录、权限控制
- [ ] **API集成**：与现有API系统集成
- [ ] **实时监控**：系统状态监控、性能指标

### 自定义开发指南
如需添加新功能，可以修改 `streamlit_database_ui.py` 文件：

1. **添加新页面**：
   ```python
   def show_new_page():
       st.header("新功能页面")
       # 添加功能代码
   
   # 在main()函数中添加导航
   page = st.sidebar.selectbox(
       "选择页面",
       ["📊 数据概览", "👥 用户管理", "🍪 Cookie管理", "🆕 新功能"]
   )
   ```

2. **添加数据库操作**：
   ```python
   # 在database.py中添加新方法
   def new_database_operation(self):
       # 实现数据库操作
       pass
   ```

3. **添加表单验证**：
   ```python
   if st.form_submit_button("提交"):
       if not user_id:
           st.error("用户ID不能为空")
       elif len(user_id) < 10:
           st.error("用户ID格式不正确")
       else:
           # 处理提交
           pass
   ```

## 📞 技术支持

### 系统要求
- **Python版本**：3.8+
- **操作系统**：Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **内存**：最少512MB，推荐2GB+
- **存储**：最少100MB可用空间

### 获取帮助
如遇到问题，请按以下步骤检查：

1. **检查环境**：
   ```bash
   python --version
   pip list | grep streamlit
   ```

2. **检查数据库**：
   ```bash
   sqlite3 douyin_data.db ".tables"
   ```

3. **检查网络**：
   ```bash
   curl http://localhost:8502
   ```

4. **查看错误日志**：
   - 控制台错误信息
   - Streamlit日志文件
   - 系统日志

### 常见错误代码
- **ModuleNotFoundError**：依赖未安装
- **PermissionError**：文件权限问题
- **ConnectionRefusedError**：端口被占用
- **DatabaseError**：数据库文件损坏

## 📝 更新日志

### v1.0.0 (2025-08-31)
- ✅ 基础数据概览功能
- ✅ 用户管理功能（增删改查）
- ✅ Cookie管理功能
- ✅ 响应式界面设计
- ✅ 实时数据更新
- ✅ 错误处理和提示
- ✅ 多平台支持（Windows/Linux/Mac）

### 未来版本计划
- **v1.1.0**：添加数据导出功能
- **v1.2.0**：添加数据可视化
- **v1.3.0**：添加批量操作
- **v2.0.0**：添加用户认证系统

## 🎯 最佳实践

### 日常使用建议
1. **定期备份数据**：建议每天备份一次数据库
2. **监控系统状态**：定期检查服务运行状态
3. **及时更新依赖**：保持Streamlit和pandas版本最新
4. **合理设置权限**：生产环境使用最小权限原则

### 性能优化
1. **数据库优化**：
   ```sql
   -- 创建索引
   CREATE INDEX idx_users_nickname ON users(nickname);
   CREATE INDEX idx_videos_user_id ON videos(user_id);
   ```

2. **应用优化**：
   - 使用分页显示大量数据
   - 缓存频繁查询的结果
   - 异步处理耗时操作

3. **系统优化**：
   - 定期清理日志文件
   - 监控内存和CPU使用
   - 使用SSD存储数据库

---

**🎉 感谢使用SQLite数据库管理界面！如有问题或建议，请及时反馈。**
